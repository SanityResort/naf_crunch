<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Eurobowl Charts</title>
    <link rel="stylesheet" href="css/chart.css"/>
    <script src="js/d3.v4.js"></script>
    <script src="js/drawcharts.js"></script>

    <!-- Bootstrap -->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
          integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>
    <script type="text/javascript" src="js/bootstrap-multiselect.js"></script>
    <script type="text/javascript" src="js/bootstrap-multiselect-collapsible-groups.js"></script>
    <script type="text/javascript" src="js/Sortable.min.js"></script>
    <script type="text/javascript" src="js/jquery.scrollintoview.min.js"></script>
    <link rel="stylesheet" href="css/bootstrap-multiselect.css" type="text/css"/>

</head>
<body id="body">
<div id="content">
    <div class="alert alert-danger collapse" role="alert" id="alert" aria-expanded="false">
        <button type="button" class="close" id="alertButton" aria-label="Close">
            <span>&times;</span>
        </button>
        <strong>Error: </strong>You must select at least one tournament, race, opponent race and one field to group the
        data by.
    </div>

    <div id="panelWrapper">

        <div id="panelHeader" class="collapser panelHeader"></div>
        <table id="panelTable">
            <tr id="controlPanel" aria-expanded="true" class="controlPanel collapse in">
                <td id="filter">
                    <div class="headline">Select Data</div>
                    <table>
                        <tr class="select-container">
                            <td><label class="select-label">Tournaments</label></td>
                            <td><select id="tournaments" class="select" multiple="multiple">
                                <optgroup label="2016">
                                    <option value="EuroBowl - 2016" selected="selected">EuroBowl - 2016</option>
                                    <option value="EurOpen - 2016" selected="selected">EurOpen - 2010</option>
                                </optgroup>
                                <optgroup label="2014">
                                    <option value="EuroBowl - 2014" selected="selected">EuroBowl - 2014</option>
                                    <option value="EurOpen - 2014" selected="selected">EurOpen - 2014</option>
                                </optgroup>
                                <optgroup label="2013">
                                    <option value="EuroBowl - 2013" selected="selected">EuroBowl - 2013</option>
                                    <option value="EurOpen - 2013" selected="selected">EurOpen - 2013</option>
                                </optgroup>
                                <optgroup label="2012">
                                    <option value="EuroBowl - 2012" selected="selected">EuroBowl - 2012</option>
                                    <option value="EurOpen - 2012" selected="selected">EurOpen - 2012</option>
                                </optgroup>
                                <optgroup label="2010">
                                    <option value="EuroBowl - 2010" selected="selected">EuroBowl - 2010</option>
                                    <option value="EurOpen - 2010" selected="selected">EurOpen - 2010</option>
                                </optgroup>
                                <optgroup label="2009">
                                    <option value="EuroBowl - 2009" selected="selected">EuroBowl - 2009</option>
                                </optgroup>
                                <optgroup label="2008">
                                    <option value="EuroBowl - 2008" selected="selected">EuroBowl - 2008</option>
                                </optgroup>
                                <optgroup label="2006">
                                    <option value="EuroBowl - 2006" selected="selected">EuroBowl - 2006</option>
                                </optgroup>
                                <optgroup label="2005">
                                    <option value="EuroBowl - 2005" selected="selected">EuroBowl - 2005</option>
                                </optgroup>
                                <optgroup label="2004">
                                    <option value="EuroBowl - 2004" selected="selected">EuroBowl - 2004</option>
                                </optgroup>
                                <optgroup label="2003">
                                    <option value="EuroBowl - 2003" selected="selected">EuroBowl - 2003</option>
                                </optgroup>
                            </select></td>
                        </tr>
                        <tr class="select-container">

                            <td><label class="select-label">Races</label></td>
                            <td><select id="races" class="select" multiple="multiple">
                                <option value="Amazons" selected="selected">Amazons</option>
                                <option value="Chaos" selected="selected">Chaos</option>
                                <option value="Chaos Dwarves" selected="selected">Chaos Dwarves</option>
                                <option value="Chaos Pact" selected="selected">Chaos Pact</option>
                                <option value="Dark Elves" selected="selected">Dark Elves</option>
                                <option value="Dwarves" selected="selected">Dwarves</option>
                                <option value="Elves" selected="selected">Elves</option>
                                <option value="Goblins" selected="selected">Goblins</option>
                                <option value="Halflings" selected="selected">Halflings</option>
                                <option value="High Elves" selected="selected">High Elves</option>
                                <option value="Humans" selected="selected">Humans</option>
                                <option value="Khemri" selected="selected">Khemri</option>
                                <option value="Lizardmen" selected="selected">Lizardmen</option>
                                <option value="Necromantic" selected="selected">Necromantic</option>
                                <option value="Norse" selected="selected">Norse</option>
                                <option value="Nurgle's Rotters" selected="selected">Nurgle's Rotters</option>
                                <option value="Ogres" selected="selected">Ogres</option>
                                <option value="Orc" selected="selected">Orc</option>
                                <option value="Skaven" selected="selected">Skaven</option>
                                <option value="Slann" selected="selected">Slann</option>
                                <option value="Undead" selected="selected">Undead</option>
                                <option value="Underworld" selected="selected">Underworld</option>
                                <option value="Vampires" selected="selected">Vampires</option>
                                <option value="Wood Elves" selected="selected">Wood Elves</option>
                            </select></td>
                        </tr>
                        <tr class="select-container">
                            <td>
                                <label class="select-label">Opponent Races</label></td>
                            <td><select id="opponentraces" class="select" multiple="multiple">
                                <option value="Amazons" selected="selected">Amazons</option>
                                <option value="Chaos" selected="selected">Chaos</option>
                                <option value="Chaos Dwarves" selected="selected">Chaos Dwarves</option>
                                <option value="Chaos Pact" selected="selected">Chaos Pact</option>
                                <option value="Dark Elves" selected="selected">Dark Elves</option>
                                <option value="Dwarves" selected="selected">Dwarves</option>
                                <option value="Elves" selected="selected">Elves</option>
                                <option value="Goblins" selected="selected">Goblins</option>
                                <option value="Halflings" selected="selected">Halflings</option>
                                <option value="High Elves" selected="selected">High Elves</option>
                                <option value="Humans" selected="selected">Humans</option>
                                <option value="Khemri" selected="selected">Khemri</option>
                                <option value="Lizardmen" selected="selected">Lizardmen</option>
                                <option value="Necromantic" selected="selected">Necromantic</option>
                                <option value="Norse" selected="selected">Norse</option>
                                <option value="Nurgle's Rotters" selected="selected">Nurgle's Rotters</option>
                                <option value="Ogres" selected="selected">Ogres</option>
                                <option value="Orc" selected="selected">Orc</option>
                                <option value="Skaven" selected="selected">Skaven</option>
                                <option value="Slann" selected="selected">Slann</option>
                                <option value="Undead" selected="selected">Undead</option>
                                <option value="Underworld" selected="selected">Underworld</option>
                                <option value="Vampires" selected="selected">Vampires</option>
                                <option value="Wood Elves" selected="selected">Wood Elves</option>
                            </select></td>
                        </tr>
                    </table>
                </td>
                <td id="splitfields">
                    <div class="headline">Group By</div>
                    <div id="image-wrapper">
                        <div class="img-desc">Fine</div>
                        <img id="splitfields-image" src="img/splitfields.svg"/>
                        <div class="img-desc">Coarse</div>

                    </div>
                    <div id="field-wrapper">
                        <label class="splitfield"><input type="checkbox" value="opponentrace">Opponent Race</label>
                        <label class="splitfield"><input type="checkbox" value="race" checked="checked">Race</label>
                        <label class="splitfield"><input type="checkbox" value="tournament">Tournament</label>
                        <label class="splitfield"><input type="checkbox" value="year">Year</label>
                    </div>
                </td>
                <td id="buttons">
                    <div id="help-container">
                        <img id="help-icon" src="img/help.svg">
                    </div>
                    <div class="select-container">
                        <button id="createButton">Create graph</button>
                    </div>
                    <div class="select-container">
                        <button id="collpaseButton" class="collapser">Hide panel</button>
                    </div>
                </td>
            </tr>
        </table>
        <div id="panelFooter" class="collapser panelFooter"></div>
    </div>

    <div id="hiddenPanelWrapper">

        <div id="hiddenPanelHeader" class="panelHeader"></div>
        <div id="hiddenPanel" aria-expanded="true" class="controlPanel collapse in">
        </div>
        <div id="hiddenPanelFooter" class="panelFooter"></div>
    </div>
    <div id="tooltip"></div>
    <div id="svgparent"></div>

    <script type="text/javascript">
    let getValues = function(array){
        return $.map(array, function(option, i) {return option.value})
    }

    $(document).ready(function() {
        let chartService = ChartService();

        $('#tournaments').multiselect({
            enableClickableOptGroups: true,
            allSelectedText: "All Tournaments",
            maxHeight: 200,
            includeSelectAllOption: true
        });
        $('#races').multiselect({
            enableClickableOptGroups: true,
            allSelectedText: "All Races",
            maxHeight: 200,
            includeSelectAllOption: true
        });
        $('#opponentraces').multiselect({
            enableClickableOptGroups: true,
            allSelectedText: "All Races",
            maxHeight: 200,
            includeSelectAllOption: true
        });

        Sortable.create(document.getElementById('field-wrapper'), {animation: 150})
            Sortable.create(document.getElementById('svgparent'), {animation: 500})

        $('.collapser').click(function(){
            $('.controlPanel').collapse('toggle')
        })

        $('#alertButton').click(function(){
            $('#alert').collapse('toggle');
        })

        $('#help').click(function(){
            $(this).hide();
        })

        $('#help-icon').click(function(){
             $('#help').show();
        })


        $('#createButton').click(function() {
           let tournaments = getValues($('#tournaments option:selected'))
           let races = getValues($('#races option:selected'))
           let opponentRaces = getValues($('#opponentraces option:selected'))
           let splitfields = getValues($('#splitfields input:checked'))
           let splitfieldNames = $.map($('#splitfields input:checked'), function(option, i) {return $(option).parent().text()})

            if (tournaments.length == 0 || races.length == 0 || opponentRaces.length == 0 || splitfields.length == 0 ) {
                $('#alert').collapse('toggle');
            } else {

           d3.select('body').append('div').attr('class', 'spinner').append('div').attr('class','spinnerText').text('Calculating...')
           let existingSvgs = $('.svgcontainer').length;
           let newId = 'svgcontainer-'+(existingSvgs+1);
           d3.select('#svgparent').append('div').attr('id',newId).attr('class','svgcontainer').attr('display', 'inline-block')
           d3.select('#svgparent').append('a').attr('id', 'a-'+newId)
           chartService.draw(tournaments, races, opponentRaces, splitfields, splitfieldNames, newId)
           }
        })

    });


    </script>
</div>


<svg id="svgdef" height="0" width="0" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <defs>
        <linearGradient id="gradient" x1="0" x2="0" y1="0" y2="1">
            <stop stop-color="yellow" offset="0%"/>
            <stop stop-color="#880" offset="100%"/>
        </linearGradient>
    </defs>
</svg>
<div id="help">
    <div id="help-text">
        This tool uses the game results of all EuroBowl and EurOpen tournaments as they are recorded in the NAF
        database. It allows you to create graphs showing the win percentages of selected races grouped by different
        attributes.
    </div>

    <dl>
        <dt>Select Data</dt>
        <dd>Here you can choose what data you want to include in the graph.
            <dl>
                <dt>Tournaments</dt>
                <dd>List of EuroBowl and EurOpen tournaments available for selection. You can also select all
                    tournaments of a
                    year by clicking on the year. You have to select at least one tournament.
                </dd>
                <dt>Races</dt>
                <dd>Select the races for which games should be included, i.e. if you only select Amazons and Orcs, only
                    games
                    for Amazons and Orcs will be included. You have to select at least one race.
                </dd>
                <dt>Opponent Races</dt>
                <dd>Select the opponent's races for which games should be included, i.e. if you selecte Amazons and Orcs
                    in the
                    race drop down and Norse and Humans for opponent races, only games of Amazons against Norse and
                    Humans and
                    of Orcs against Norse and Humans will be included. You have to select at least one race.
                </dd>
            </dl>
        </dd>
        <dt>Group By</dt>
        <dd>This list defines how the selected data is grouped/split to provide a more fine grained analysis. The order
            of the fields to group by (Opponent Race, Race, Tournament, Year) is significant, as indicated by the arrow.
            You can reorder the fields by drag and drop.
        </dd>
        <dd>In the default selection you would get a graph with 24 bars, one for each of the 24 races showing the
            overall win percentage of said race over all tournaments. If you also select to group by tournaments you
            would get a group of bars for each included tournament, where each group contains a bar for each race that
            played in said tournament. This will be the option you will toy around with the most.
        </dd>
        <dd><strong>Note:</strong> For each grouping attribute a separate x-Axis is generated. The labels on those axes
            are sorted according to their natural order (alphabetically and numerically ascending). This means if you
            group data by tournament EurOpen data will be displayed first. This is a current inconvenience/bug. To work
            around this you can also select to group by year and put the year below tournaments in the grouping order
            (default order).
        </dd>
        <dt>Graphs</dt>
        <dd>New graphs will be appended at the bottom of the page but can be reordered with drag and drop. Should you
            have problems with that, try hiding the control panel. When a new
            graph is created it is scrolled into view. Each bar in a graph also has a tooltip showing the amount of
            games, wins, draws and losses the win percentage was calculated from.
        </dd>
    </dl>
    <div id="help-footer">
        - Click to close -
    </div>
</div>
</body>
</html>